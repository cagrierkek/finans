<script>
let rates = { usd:0, eur:0, gold:0 };

async function loadRates() {
  const res = await fetch("https://api.allorigins.win/raw?url=https://www.tcmb.gov.tr/kurlar/today.xml");
  const text = await res.text();

  const parser = new DOMParser();
  const xml = parser.parseFromString(text, "text/xml");

  rates.usd = Number(xml.querySelector("Currency[CurrencyCode='USD'] ForexSelling").textContent.replace(",", "."));
  rates.eur = Number(xml.querySelector("Currency[CurrencyCode='EUR'] ForexSelling").textContent.replace(",", "."));

  const goldRes = await fetch("https://api.allorigins.win/raw?url=https://finans.truncgil.com/today.json");
  const goldData = await goldRes.json();
  rates.gold = Number(goldData["gram-altin"]["Alış"].replace(",", "."));

  document.getElementById("rates").innerText =
    `USD: ${rates.usd.toFixed(2)} | EUR: ${rates.eur.toFixed(2)} | Gram Altın: ${rates.gold.toFixed(2)} TL`;
}

function calculate() {
  const total =
    Number(tl.value) +
    Number(usd.value) * rates.usd +
    Number(eur.value) * rates.eur +
    Number(gold.value) * rates.gold +
    Number(stockQty.value) * Number(stockPrice.value);

  document.getElementById("total").innerText =
    "Toplam Varlık (TL): " + total.toFixed(2);
}

loadRates();
</script>
